{% extends "base.html" %}

{% block title %}Login - Monitoring Portal{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="logo">üîê</div>
        <h1 style="color: #1e3c72; margin-bottom: 10px;">Monitoring Portal</h1>
        <p class="subtitle">Secure access to your monitoring infrastructure</p>

        {% if error %}
        <div class="alert alert-danger">
            <strong>Login Failed:</strong> {{ error }}
        </div>
        {% endif %}

        <!-- Username/Password Login Form -->
        <div id="direct-login" style="margin: 30px 0;">
            <h3 style="color: #1e3c72; margin-bottom: 20px; font-size: 1.2rem;">Login with Username & Password</h3>

            <form method="POST" action="{{ url_for('direct_login') }}">
                <div style="margin-bottom: 15px; text-align: left;">
                    <label for="username" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 0.9rem;">Username:</label>
                    <input type="text"
                           id="username"
                           name="username"
                           required
                           placeholder="Enter your username"
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 20px; text-align: left;">
                    <label for="password" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 0.9rem;">Password:</label>
                    <input type="password"
                           id="password"
                           name="password"
                           required
                           placeholder="Enter your password"
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; box-sizing: border-box;">
                </div>

                <button type="submit" class="btn" style="width: 100%; margin: 0; padding: 12px;">
                    üîì Login
                </button>
            </form>
        </div>

        <!-- Divider -->
        <div style="margin: 25px 0; display: flex; align-items: center; color: #666;">
            <div style="flex: 1; height: 1px; background: #ddd;"></div>
            <div style="margin: 0 15px; font-size: 0.9rem;">OR</div>
            <div style="flex: 1; height: 1px; background: #ddd;"></div>
        </div>

        <!-- SSO Login -->
        <div id="sso-login" style="margin: 25px 0;">
            <h3 style="color: #1e3c72; margin-bottom: 15px; font-size: 1.2rem;">Single Sign-On</h3>
            <a href="{{ url_for('login') }}" class="btn btn-secondary" style="width: 100%; padding: 12px; text-decoration: none; display: block;">
                üè¢ Login with SSO
            </a>
        </div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
            <p style="font-size: 0.9rem; color: #888;">
                This system uses Active Directory authentication through Keycloak SSO.
            </p>
        </div>
    </div>
</div>

<script>
// Auto-focus username field
document.getElementById('username').focus();

// Enter key handling
document.getElementById('password').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.querySelector('form').submit();
    }
});

// Form submission handling
document.querySelector('form').addEventListener('submit', function(e) {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if (!username || !password) {
        e.preventDefault();
        alert('Please enter both username and password');
        return false;
    }

    // Show loading state
    const submitBtn = document.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '‚è≥ Logging in...';
    submitBtn.disabled = true;
});

// SSO button loading state
document.querySelector('a[href*="login"]').addEventListener('click', function() {
    this.innerHTML = '‚è≥ Redirecting to SSO...';
    this.style.opacity = '0.7';
});
</script>
{% endblock %}